# Telegram
## 1. Тема и целевая аудитория

### ЦА
* Число активных пользователей в месяц: 950 млн в месяц

* Возрастное распределение аудитории:

| Возраст | Процент |
|---------|----------|
| До 17   | 6.4%    |
| 18 - 24 | 18.8%   |
| 25 - 34 | 29.4%   |
| 35 - 44 | 23.8%   |
| Более 45| 21.6%   |

* Основные страны по количеству пользователей Telegram [^2] :
1. Индия - около 104 млн
2. Россия - около 34-35 млн
3. США - около 26-29 млн

### Требования к функционалу
- MVP
1. регистрация + авторизация
2. отправка сообщений
3. удаление сообщений
4. просмотр прошлых сообщений
5. создание канала пользователя
6. список чатов, каналов
7. поиск по списку

- Ключевой функционал: Передача сообщений между пользователями
щз
- Ключевые продуктовые решения:
1. Для мессенджера был создан протокол MTProto(написан на C++), предполагающий использование нескольких протоколов шифрования
2. Секретные чаты - режим реализует сквозное шифрование(пакет данных шифруется независимо от предыдущих пакетов) с применением алгоритма AES-256. Переписка шифруется на устройстве отправителя, а расшифровывается на устройстве собеседника. Нет никаких промежуточных остановок в виде сервера

## 2. Расчет нагрузки

### Продуктовые метрики

- MAU: 950 млн [^1] 
- DAU: 196 млн. [^4]

| Данные      | Вес             |
|-------------------|-----------------------|
| Аватар         |  500-700 КБ (512 х 512)        |
| Ник    | 32 байт    |
| Имя и Фамилия      | 128 байт   |
| Статус и описание     | 255 байт      |
| Сообщение (за год)     |  примерно 34 (33,3) сообщений отправляет 1 пользователь; 34*4 КБ = 136 Кб [^8]; 136 * 365 * 11 = 546 040 КБ |

Подсчитаем суммарно данные Пользователя:  546 040 КБ + 600 КБ (в среднем аватарка) + 415 байт (данные пользователя)  = 0,55 ГБ (примерно)

Действия по MVP:

| Действие по MVP      | За год | Среднее число повторений за день | Рассчеты, если есть |
|-------------------|-----------------------|-----------------------|-----------------------|
| Регистрация  | 2.5 млн |   0,0127 на 1 пользователя в день [^7] | - |
| Отправка сообщений  | 142.5 мдрд | 33,3 [^8] |  число сообщений в день в 2016 = 15млрд [^5] ; 2016 MAU=100млн, 2024 MAU=950млн; (950/100)=9.5 раз увеличение аудитории. Число сообщений в 2024= 9.5*15 = 142.5 мдрд  |
| Создание каналов  |За год | 0,006 на 1 пользователя |  825 000 каналов в 2022 [^9], 700 млн MAU в 2022. Увеличение аудитории с 2022 по 2024: (950 / 700) ≈ 1.36 раза больше. Предполагаемое количество каналов: 825 000 * 1.36 = 1 124 000 каналов.  [^6] [^7] |
| Просмотр каналов  | 1 786 814 400 | 12.84 | [^7]  100543100 (28,9% читают до 5 каналов) + 261968700 (25,1% до 10 каналов) + 346160500(19,9% до 15 каналов) + 397997600(14,3% до 25 каналов) + 422698500(8,1% до 50 каналов) + 257446000(3,7% 50+ каналов) = 1 786 814 400 чтений каналов |

### Технические метрики

1. Хранилище.
   - Пользователи: 522 500 ТБ (считается, что есть только активные пользователи: 0.55 * 950 000 000 пользователей)
   - Каналы: 287 КБ информации + аватар канала ~600 КБ -> 887 КБ. Предполагаемое количество каналов: 1 124 000 каналов. Без сообщений = 0.997 ТБ. 136 КБ * 365 * 9 (каналы появились в 2015) = 446 760 КБ( для одного канала), 613 748 960 000 КБ = 502.16 ТБ + 0.997 ТБ = 503,16 ТБ
2. Сетевой трафик.

Пиковое значение:
   - Регистрация: 0,0127  * 196 млн * (600 КБ + 415 КБ)/86 400 = 0.03  ГБ/c = 0.24 Гбит/c
   - Отправка сообщения: 34 * 196 млн * (136 КБ)/86 400 = 10.5  ГБ/c = 84 Гбит/c
   - Создание канала: 0,006 * 196 млн * (887 КБ)/86 400 = 1043.112  ГБ/c = 8 344.896 Гбит/c

 Суточное значение:
  - Регистрация: 2 073.6 Гбит/c
  - Отправка сообщения: 7 257 600 Гбит/c = 7.26 Пбит/с
  - Создание канала: 720 999 360 Гбит/c = 721 Пбит/с
  
  Значение RPS:
  Пиковая аудитория: 80 ед / 24 (часов в сутках) = 3.333 ед; 3.333 = DAU; Пик = 7.5 ед, то есть примерно в 2 раза больше DAU. [^10]  
  Рассчитаем пуш-уведомления: 71% использует тг для просмотра каналов, 86% - для чатов. Около 41% отключают уведомдения каналов, то есть около 30% (71 - 41 = 30) получают уведомления только от чатов из тех, кто использует каналы. 
  
  
  | Запрос      | RPS             | RPS в пике            |
  |---------------|-----------------|-----------------|
  | Регистрация         | 28,8  | 57,6  |
  | Отправка сообщения | 77 129   | 154 258  |
  | Создание канала | 13,6      | 27,2     | 
  

Источники:
[^1]:  https://www.demandsage.com/telegram-statistics/
[^2]:  https://worldpopulationreview.com/country-rankings/telegram-users-by-country
[^3]:  https://tlgrm.ru/docs/mtproto
[^4]:  https://backlinko.com/telegram-users#telegram-daily-active-users
[^5]:  https://www.businessofapps.com/data/telegram-statistics/
[^6]:  https://tgstat.com/
[^7]:  https://inclient.ru/telegram-stats/#telegram11  
[^8]:  https://backlinko.com/whatsapp-users#number-of-whats-app-messages-sent-globally-per-day 
[^9]:  https://usesignhouse.com/blog/telegram-stats/#how-many-channels-are-there-on-telegram 
[^10]: https://semantica-media.ru/blog/luchshee-vremya-dlya-postov-kogda-luchshe-vykladyvat-kontent-v-soczsetyah.html


